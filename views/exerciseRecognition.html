<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
      </script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
      </script>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"> </script>
  </head>

  <body>
    <div id="loading">Loading</div>
    <video autoplay="true" id="videoElement">
    </video>
    <h1>Output : <div id="output"></div></h1>
  </body>
  <!-- Place your code in the script tag below. You can also use an external .js file -->
  <script>
    class Lambda extends tf.layers.Layer {
      static className = 'Lambda';
      constructor(config) {
        super(config);
      }
      call(input) {
        return tf.tidy(() => {
          return tf.sub(tf.div(input[0],127.5),1);
        });
      }
    }
    tf.serialization.registerClass(Lambda);
  </script>
  <script>
    const classNames = ["AEIOU", "90 90 CRUNCH", "ABDOMINAL CRUNCHES", "ADDUCTOR STRETCH IN STANDING", "AIR CYCLING", "ALT V-UP", "ALTERNATE HAMMER CURL", "ALTERNATING DUMBBELL SHOULDER PRESS", "ALTERNATING HOOKS", "ALTERNATING RENEGADE ROW", "ANTERIOR SHOULDER STRETCH", "ARM CIRCLES", "ARM CURLS CRUNCH", "ARM RAISES", "ARM SCISSORS", "ARM SWINGS", "ARM SWINGS WITH LATERAL STEPS", "ARNOLD DUMBBELL PRESS", "BACK BOW PULLS", "BACKWARD LUNGE", "BACKWARD LUNGE WITH FRONT KICK", "BENCH GLUTE KICK BACK", "BENT KNEE SIDE HIP RAISES", "BENT LEG TWIST", "BENT OVER DUMBBELL ROWS", "BENT OVER ROW", "BICEPS CURLS", "BICYCLE CRUNCHES", "BIRD DOG", "BODY SAW", "BOTTOM LEG LIFT", "BOX PUSH-UPS", "BRIDGE", "BULGARIAN SPLIT SQUAT", "BURPEES", "BUTT BRIDGE", "BUTT KICKS", "BUTTERFLY BRIDGE", "CALF RAISE WITH PIGEON-TOED", "CALF RAISE WITH SPLAYED FOOT", "CALF STRETCH", "CAT COW POSE", "CHAIR BICYCLE CRUNCH", "CHAIR SQUATS", "CHEEK FIRMER", "CHEST PRESS PULSE", "CHEST STRETCH", "CHILD POSE", "CLAPPING CRUNCHES", "CLAPS OVER HEAD", "CLASP HANDS BEHIND BACK", "COBRA STRETCH", "COBRAS", "CRAB KICK UP", "CRAB KICKS", "CRAB WALK", "CROSS ARM CRUNCHES", "CROSS BODY HAMMER CURL", "CROSS KNEE PLANK", "CROSS LEG SIDE BEND", "CROSS TOUCH AND REACH", "CROSSBODY MOUNTAIN CLIMBER", "CROSSOVER CRUNCH", "CRUNCH KICKS", "CRUNCHES WITH LEGS RAISED", "CURTSY LUNGES", "DEAD BUG", "DECLINE PUSH-UPS", "DIAGONAL PLANK", "DIAMOND PUSH-UPS", "DONKEY KICKS", "DONKEY KICKS PULSE", "DOORWAY CURLS", "DOUBLE CHOP KNEE UPS", "DOUBLE KNEES TO CHEST", "DOUBLE LEG CIRCLES", "DOWNWARD FACING DOG", "DOWNWARD FACING DOG ON THE WALL", "DRAWN CHEEKS", "DUMBBELL ARM TRICEPS KICKBACK", "DUMBBELL BACKWARD LUNGE", "DUMBBELL BENCH PRESS", "DUMBBELL BENT LEG TWIST", "DUMBBELL BICEP CURL TO PRESS", "DUMBBELL BICYCLE PASSES", "DUMBBELL BOAT HOLD", "DUMBBELL BULGARIAN SPLIT SQUAT", "DUMBBELL BUTT BRIDGE", "DUMBBELL CHEST FLY", "DUMBBELL CLOSE GRIP BENCH PRESS", "DUMBBELL CLOSE GRIP FLOOR PRESS", "DUMBBELL CONCENTRATION CURL", "DUMBBELL CRUNCH AND PUNCHES", "DUMBBELL CRUNCHES", "DUMBBELL CUBAN ROTATION", "DUMBBELL CURTSY LUNGES", "DUMBBELL DECLINE FLOOR PRESS", "DUMBBELL DONKEY KICKS", "DUMBBELL DRAG CURLS", "DUMBBELL FIRE HYDRANT", "DUMBBELL FLOOR FLY TO CLOSE GRIP PRESS", "DUMBBELL FLOOR PRESS", "DUMBBELL FLY TO CLOSE GRIP PRESS", "DUMBBELL FRONT RAISE", "DUMBBELL HAMSTRING CURL", "DUMBBELL HIP BRIDGE & LEG LIFT", "DUMBBELL HIP HINGE", "DUMBBELL HIP THRUST", "DUMBBELL JUMPING LUNGE", "DUMBBELL JUMPING SQUAT", "DUMBBELL KICKBACKS", "DUMBBELL LUNGES", "DUMBBELL LYING TRICEPS EXTENSION", "DUMBBELL PADDLE BOATS", "DUMBBELL PLANK ROTATION", "DUMBBELL PULLOVER", "DUMBBELL PULLOVER ON FLOOR", "DUMBBELL PUNCH", "DUMBBELL REAR DELT ROW", "DUMBBELL REVERSE CRUNCHES", "DUMBBELL REVERSE CURL", "DUMBBELL RUSSIAN TWIST", "DUMBBELL SEATED IN & OUTS", "DUMBBELL SHRUG", "DUMBBELL SIDE BEND", "DUMBBELL SIDE BOAT HOLD", "DUMBBELL SIDE LATERAL RAISE", "DUMBBELL SIDE LUNGES", "DUMBBELL SINGLE ARM FLY", "DUMBBELL SINGLE ARM OTIS UP", "DUMBBELL SINGLE LEG DEADLIFT", "DUMBBELL SINGLE LEG HIP THRUST", "DUMBBELL SPLIT SQUAT", "DUMBBELL SQUAT CLEAN AND PRESS", "DUMBBELL SQUATS", "DUMBBELL STANDING HIP ABDUCTION", "DUMBBELL SWING", "DUMBBELL TOE-TOUCH CRUNCH", "DUMBBELL TORTURE TUCKS", "DUMBBELL TRICEPS EXTENSION", "DUMBBELL UP-N-OVERS", "DUMBBELL UPRIGHT-ROW", "DUMBBELL V-UP", "DUMBBELL WIDE BICEP CURLS", "DUMBBELL WOODCHOP", "DYNAMIC CHEST", "Dumbbell STEP-UP ONTO CHAIR", "ELBOW PLANK ROTATION", "ELBOWS BACK", "EYE LIFT", "EYES CIRCLES", "FAST SPIDER LUNGES", "FIRE HYDRANT", "FIRE HYDRANT PULSE", "FLOOR SLIDES", "FLOOR TRICEP DIPS", "FLOOR Y RAISES", "FLUTTER KICK SQUATS", "FLUTTER KICKS", "FORWARD BEND", "FROG PRESS", "FROGGY GLUTE LIFTS", "GLUTE KICK BACK", "GLUTE KICKBACK CROSSOVER WITH LEG", "GLUTE KICKBACK PULSE", "GLUTE STRETCH", "HALF BENDING PUSHING FORWARD", "HAVYK RAISES", "HEEL TOUCH", "HEELS TO THE HEAVENS", "HIGH KNEE WITH TWIST", "HIGH STEPPING", "HINDU PUSH-UPS", "HIP BRIDGE & LEG LIFT", "HIP HINGE", "HOPS ON THE SPOT", "HOVER PUSH UP", "HYPEREXTENSION", "IN & OUTS", "INCHWORMS", "INCLINE PUSH-UPS", "JAW LINE", "JUMPING JACKS", "JUMPING PUSH-UPS", "JUMPING SQUATS", "KICK CRUNCH", "KNEE CIRCLE", "KNEE LIFT", "KNEE PUSH-UPS", "KNEE TO CHEST STRETCH", "KNEE TO ELBOW CRUNCHES", "KNEELING LUNGE STRETCH", "KNEELING SIDE PLANK", "LATERAL PLANK WALK", "LEANING DUMBBELL ONE LEG CALF RAISE", "LEANING STRETCHER RAISES", "LEG BARBELL CURL", "LEG IN & OUTS", "LEG LATERAL RAISE", "LEG RAISES", "LEG SPREADS", "LEGS UP THE WALL", "LEVATOR SCAPULAE STRETCH", "LION", "LIPS DOWN PULL", "LONG ARM CRUNCHES", "LUNGE KNEE HOPS", "LUNGE TWIST", "LUNGES", "LYING BUTTERFLY STRETCH", "LYING DUMBBELL LATERAL RAISE", "LYING KNEE HUG", "LYING SWING LEGS", "LYING TWIST STRETCH", "MARCHIN HIP RAISES", "MARILYN", "MILITARY PRESS", "MILITARY PUSH UPS", "MODIFIED BURPEES", "MODIFIED PUSH-UP LOW HOLD", "MOUNTAIN CLIMBER", "MOUNTAIN CLIMBER SQUAT THRUST", "MOUTH CIRCLES", "NECK LIFT", "NOSE TOUCHING", "OBLIQUE CROSSOVER CRUNCH", "OBLIQUE CRUNCH REACH", "OBLIQUE V-UPS", "OFFSET PUSH-UPS", "ONE ARM DUMBBELL LATERAL RAISE", "ONE DOWN TWO UPS", "ONE LEG BRIDGE", "ONE LEG PUSH-UPS", "OPEN CHAIN KNEE EXTENSION", "OVERHEAD ARM CIRCLES", "PENDULUM SWINGS", "PIKE PUSH UPS", "PILATES CLAMSHELL", "PILATES LEG PULLS", "PISTOL BOX SQUAT", "PLANK", "PLANK AND REACH", "PLANK HIP DIPS", "PLANK JACKS", "PLANK LEG UP", "PLANK TAPS", "PLIE SQUATS", "PRONE FLUTTER KICKS", "PRONE TRICEPS PUSH UPS", "PUFFY CHEEKS", "PUNCHES", "PUSH-UP & ROTATION", "PUSH-UP ROW", "PUSH-UP WITH TOE TAP", "PUSH-UPS", "QUAD STRETCH", "QUAD STRETCH WITH WALL", "QUARTER WALL SQUAT", "QUICK FEET", "RECLINED OBLIQUE TWIST", "RECLINED RHOMBOID SQUEEZES", "REVERSE CRUNCHES", "REVERSE CRUNCHES WITH LEG RAISED", "REVERSE FLUTTER KICKS", "REVERSE FLYS", "REVERSE PUSH-UPS", "REVERSE SNOW ANGELS", "RHOMBOID PULLS", "ROUNDHOUSE SQUAT KICKS", "RUN ON THE WALL", "RUSSIAN TWIST", "SCISSORS", "SEATED ABS CIRCLES", "SEATED BUTTERFLY STRETCH", "SEATED IN & OUTS", "SEATED OVERHEAD TRICEP EXTENSION", "SEATED SIDE BEND", "SEATED SPINAL TWIST", "SHOULDER GATORS", "SHOULDER OUTWARD ROTATION", "SHOULDER ROLLS", "SHOULDER STRETCH", "SHOULDER STRETCH WITH CHAIR", "SIDE ARM RAISE", "SIDE BRIDGES", "SIDE CRUNCHES", "SIDE HOP", "SIDE LEG CIRCLES", "SIDE LEG RAISE", "SIDE LUNGES", "SIDE LYING FORWARD LEG LIFT", "SIDE LYING KICKBACK", "SIDE NECK STRETCH", "SIDE PLANK", "SIDE PLANK FRONT KICK", "SIDE PLANK KNEE CRUNCH", "SIDE STEP JACKS", "SIDE-LYING FLOOR STRETCH", "SIDE-LYING LEG LIFT", "SIDE-TO-SIDE TILTS", "SIDE-TO-SIDE TURNS", "SINGLE ARM RENEGADE ROW", "SINGLE LEG CALF HOP", "SINGLE LEG CALF RAISES", "SINGLE LEG DEADLIFT", "SINGLE LEG DROPS", "SINGLE LEG HIP ROTATION", "SIT-UP TWIST", "SIT-UPS", "SITTING HAMSTRING STRETCH", "SKATER JUMP", "SKI SQUAT & LEG LIFT", "SKIPPING WITHOUT ROPE", "SLOW MOUNTAIN CLIMBER", "SMILE", "SMILING FISH FACE", "SPIDERMAN PLANK", "SPIDERMAN PUSH-UPS", "SPINE LUMBAR TWIST STRETCH", "SPLIT SQUAT", "SQUAT JACKS", "SQUAT KICKS", "SQUAT PULSES", "SQUAT REACH UPS", "SQUAT THRUST WITH TWIST", "SQUATS", "STAGGERED PUSH-UPS", "STANDING BICEPS STRETCH", "STANDING BICYCLE CRUNCHES", "STANDING CROSSOVER TOE TOUCHES", "STANDING DUMBBELL CALF RAISE", "STANDING DUMBBELL CHEST FLY", "STANDING DUMBBELL CURL", "STANDING GLUTE KICKBACKS", "STANDING HIP CIRCLE", "STANDING KNEE TO CHEST", "STANDING OBLIQUE CRUNCHES", "STANDING SIDE BEND", "STAR CRAWL", "STAR JUMPS", "STARFISH CRUNCH", "STEP-UP ONTO CHAIR", "STRAIGHT ARM PLANK TO PIKE", "STRAIGHT LEG BOUNDS", "STRAIGHT LEG FIRE HYDRANT", "STRAIGHT LEG RAISE", "STRAIGHT-ARM PLANK", "SUMO SQUAT", "SUMO SQUAT & LEG RAISES", "SUMO SQUAT CALF RAISES", "SUMO SQUAT CALF RAISES WITH WALL", "SUPERMAN", "SUPINE HAMSTRING STRETCH", "SUPINE PUSH UP", "SWIMMER AND SUPERMAN", "T PLANK", "THE ROLL", "TIGER BEND PUSH-UPS", "TIP TOE SQUATS", "TOE TAP", "TORSO TWIST", "TOY SOLDIERS", "TRIANGLE POSE", "TRICEP DUMBBELL FLICK BACK", "TRICEPS DIPS", "TRICEPS KICKBACKS", "TRICEPS STRETCH", "TRUNK ROTATION", "TWISTING PISTON", "UNDERCHIN DUCK", "UP & DOWN NODS", "UP AND DOWN PLANK", "V CRUNCH", "V-HOLD", "V-UP", "VALLEY PRESS", "WALKING SQUATS", "WALL CALF RAISES", "WALL GLUTE KICKBACK HOLD", "WALL PUSH-UPS", "WALL RESISTING SINGLE LEG CALF RAISE", "WALL SIT", "WALL STANDING GLUTE KICKBACKS", "WIDE ARM PUSH-UPS", "WINDSHIELD WIPERS", "WOOD  CHOPS", "WRISTS & ANKLES STRETCH", "X MAN CRUNCH", "X-BURPEES", "ZOTTMAN CURL"];
    let model = null;
    let video = null;
    let currentExercise = null;
    let output = document.getElementById("output");
    let loading = document.getElementById("loading");

    const predict = async () => {
      const tfImg = tf.browser.fromPixels(video);
      const smalImg = tf.image.resizeBilinear(tfImg, [160, 160]);
      const resized = tf.cast(smalImg, 'float32');
      const t4d = tf.tensor4d(Array.from(resized.dataSync()),[1,160,160,3]);
      const prediction = await model.predict(t4d).data();
      const res = await tf.tensor1d(prediction).argMax().data();
      if(prediction[res[0]] > 0.5) {
        output.textContent = classNames[res[0]] + " with accuracy " + prediction[res[0]]*100 + "%";
        currentExercise = classNames[res[0]];
      }
      else {
        output.textContent = currentExercise || "No Exercise Detected";
      }
      return requestAnimationFrame(predict)
    }

    const exe = async() => {
        console.log("load started")
        model = await tf.loadLayersModel('https://parekafox.herokuapp.com/TFJS_MODEL/model.json');
        console.log("model loaded")
        loading.textContent = "";
        video = document.querySelector("#videoElement");
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.onloadeddata = predict;
    }
    exe()
  </script>
</html>